@if(isLoaded) {
<div class="container mt-5">
  <div class="container">
    <div class="d-flex flex-column flex-md-row">
        <img mat-card-image [src]="getImageUrl()" class="mx-auto mx-md-0" style="max-width: 400px;" width="100%" alt="Photo">
        <div class="d-flex flex-column justify-content-between mt-3 ms-0 ms-md-5">
          <div>
              <h3>{{product.brand.name}}</h3>
              <h2>{{product.name}}</h2>
              <h3>{{product.type.name}}</h3>
              <p>{{product.description}}</p>
              <h3>Category:  {{product.category.name}}</h3>
              <div class="mb-4">
                <h3>Scent profile</h3>
                  <div>
                    <div class="row row-cols-3 fw-medium my-3">
                      <span class="col">Note</span>
                      <span class="col">Layer</span>
                      <span class="col"></span>
                    </div>
                  </div>
                @for(noteType of noteTypes; track noteType;) {
                  @for(productNote of product.productNotes; track productNote; let idx = $index) {
                    @if (productNote.noteType.noteTypeId == noteType.noteTypeId) {
                        <div class="row row-cols-3">
                          <span class="col my-auto">{{productNote.note.name}}</span>
                          <span class="col my-auto">{{productNote.noteType.name}}</span>
                        </div>
                    }
                  } 
                  <mat-divider class="my-2"></mat-divider>
                }
              </div>
              <h4 class="mt-5">Available sizes</h4>
              <mat-form-field appearance="outline">
                <mat-select [(ngModel)]="selectedSizePrice" name="food" class="w-100">
                  @for (sizePrice of product.sizePrices; track sizePrice) {
                    <mat-option [value]="sizePrice" class="w-100">
                      <span class="size-price-option">{{sizePrice.size}} ml </span><span> for </span><span class="size-price-option">{{sizePrice.price}} â‚¬</span>
                    </mat-option>
                  }
                </mat-select>
              </mat-form-field>
          </div>
          <div class="d-flex flex-row mx-auto mt-3">
            <div style="width: 115px;">
              <mat-form-field style="width: 100%; font-size: 14px; margin-bottom: -20px;" appearance="outline">
                <mat-label>Amount</mat-label>
                <mat-select [(ngModel)]="selectedAmount" name="food">
                  @for (amount of amounts; track amount) {
                    <mat-option [value]="amount">{{amount}}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
            <div>
            <button 
              mat-flat-button 
              class="h-100 ms-2" 
              color="primary"
              (click)="addProductToCart(); openSnackBar('Product added to Cart!', 'Dismiss')">
              <span>Add to cart</span>
              <mat-icon>shopping_basket</mat-icon>
            </button>
            </div>
          </div>
        </div>
    </div>
  </div>
  <div class="container my-5">
    @if(isAdmin){
      <div class="my-3">
        <button mat-stroked-button (click)="editProduct()" class="mx-1">
          Edit Fragrance 
        </button>
        <button mat-stroked-button color="warn" (click)="deleteProduct()" class="mx-1">
          Delete Fragrance
        </button>
      </div>
    }
    <mat-accordion>
      <mat-expansion-panel (opened)="panelOpenState = true"
                           (closed)="panelOpenState = false"
                           [disabled]="product.averageRatingAndCount!.count == 0"
                           class="mat-elevation-z0">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Reviews
          </mat-panel-title>
          <mat-panel-description>
            <span>{{product.averageRatingAndCount!.averageRating ? product.averageRatingAndCount!.averageRating : 'No Reviews'}}</span>
            <mat-icon>star</mat-icon>
            <span>({{product.averageRatingAndCount!.count}})</span>
          </mat-panel-description>
        </mat-expansion-panel-header>
        @for(review of product.reviews; track review) {
          <div class="d-flex flex-column mt-3 mb-4">
            <div>
              <p>{{review.comment}}</p>
            </div>
            <div class="d-flex flex-row align-items-center">
              @for(star of starArray; track star; let i = $index) {
                  <mat-icon color="accent" [id]="'star_'+i">
                    {{showRatingIcon(review.rating, i)}}
                  </mat-icon>
              }
              <span class="mx-3 fw-medium">{{review.userName}}</span>
              <span class=" fw-medium">{{review.createdAt | date:'longDate'}}</span>
            </div>
          </div>
        }
      </mat-expansion-panel>
    </mat-accordion>
  </div>
</div>
}
@else {
    Loading....
}
